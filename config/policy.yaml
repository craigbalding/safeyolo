# SafeYolo Policy Configuration
#
# Controls which addons run on which domains/clients.
# Hot-reloads on file change or SIGHUP.
#
# NOTE: It's safe to reference addons that aren't in your build (e.g., yara_scanner
# in base build). The policy engine ignores missing addons gracefully.

defaults:
  addons:
    rate_limiter:
      enabled: true
    circuit_breaker:
      enabled: true
    credential_guard:
      enabled: true
    yara_scanner:
      enabled: true
    pattern_scanner:
      enabled: true
    prompt-injection:
      enabled: false  # Requires classifier service

# Per-domain overrides
domains:
  # SSE/streaming endpoints - enable response streaming
  "ntfy.sh":
    addons:
      sse_streaming:
        enabled: true
        stream_json: true  # ntfy uses /json endpoint for streaming

  "mcp.apify.com":
    addons:
      sse_streaming:
        enabled: true
  # LLM APIs - enable injection detection if classifier available
  "api.openai.com":
    addons:
      prompt-injection:
        enabled: true
        mode: dual

  "api.anthropic.com":
    addons:
      prompt-injection:
        enabled: true
        mode: dual

  # Internal services - trust them more
  "*.internal":
    bypass:
      - yara_scanner
      - pattern_scanner
      - prompt-injection

  # Telemetry/analytics - not LLM traffic
  "statsig.anthropic.com":
    bypass:
      - prompt-injection

  "*.datadoghq.com":
    bypass:
      - prompt-injection

  "*.segment.io":
    bypass:
      - prompt-injection

  # Package registries - skip heavy scanning
  "pypi.org":
    bypass:
      - yara_scanner
      - prompt-injection

  "registry.npmjs.org":
    bypass:
      - yara_scanner
      - prompt-injection

# Per-client overrides (via X-Client-ID header)
clients:
  # Admin clients bypass pattern scanning
  "admin-*":
    bypass:
      - pattern_scanner

  # Test clients bypass rate limiting
  "test-*":
    addons:
      rate_limiter:
        enabled: false
