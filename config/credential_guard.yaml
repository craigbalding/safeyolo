# Credential Guard v2 Configuration

# HMAC secret for credential fingerprinting
# If not set, will be auto-generated on first run and saved to /app/data/hmac_secret
# You can also set via environment variable: CREDGUARD_HMAC_SECRET
hmac_secret: null

# Temp allowlist TTL (seconds)
# How long a manual approval lasts before requiring re-approval
temp_allowlist_ttl: 300

# Entropy thresholds for heuristic detection
entropy:
  # Minimum character length to consider as potential secret
  min_length: 20

  # Minimum charset diversity (unique chars / total chars)
  # 0.5 = at least 50% of characters are unique
  min_charset_diversity: 0.5

  # Minimum Shannon entropy (bits per character)
  # Higher = more random-looking
  # Typical values: 3.0-4.5 for secrets
  min_shannon_entropy: 3.5

# Standard auth headers to always scan
# These are checked without heuristics (direct pattern matching)
standard_auth_headers:
  - authorization
  - x-api-key
  - api-key
  - x-auth-token
  - apikey

# Response behavior
response:
  # Use LLM-friendly verbose messages (vs terse JSON)
  llm_friendly: true

  # HTTP status code for blocks
  # 403: Forbidden (old behavior)
  # 428: Precondition Required (new v2 behavior for greylisting)
  status_code: 428

# Logging
logging:
  # Path for violation logs (JSONL format)
  # null = use mitmproxy option credguard_log_path
  log_path: null

  # Never log raw credentials (always true for security)
  redact_credentials: true

# Policy storage
policy:
  # Directory for per-project policy files
  # Will be mounted from host: ${SAFEYOLO_POLICY_DIR:-~/.safeyolo/policies}
  policy_dir: /app/data/policies

  # Watch for file changes and reload
  watch_for_changes: true

  # Validation: reject invalid YAML on load
  strict_validation: true

# Approval backends
approval:
  # Which backend to use: ntfy, manual, or none
  backend: ntfy

  # Ntfy configuration (when backend=ntfy)
  ntfy:
    # Ntfy server URL
    server: https://ntfy.sh

    # Topic to send to (should be unique/secret)
    # Set via environment variable: NTFY_TOPIC
    topic: null

    # Message priority (1-5, where 5 is urgent)
    priority: 4

    # Tags for notifications
    tags: ["warning", "lock"]

# Feature flags
features:
  # Scan request URLs for credentials (in addition to headers)
  scan_urls: false

  # Scan request bodies for credentials
  scan_bodies: false

  # Enable HMAC fingerprinting (v2 feature)
  hmac_fingerprinting: true

  # Enable smart header analysis (v2 feature)
  smart_header_analysis: true

  # Enable default policy (v2 feature)
  use_default_policy: true
